<?xml version="1.0" encoding="utf-8"?>
<odoo>
    <template id="result_pdf_template" name="Survey Result">
        <t t-call="web.html_container">
            <t t-foreach="docs" t-as="doc">
                <t t-call="web.external_layout">
                    <div class="page">
                        <t t-foreach="[i for i in doc.survey_id.question_and_page_ids.sorted(key=lambda l: (l.sequence))]"
                           t-as="question">
                            <t t-foreach="doc.user_input_line_ids" t-as="line">

                                <tr>
                                    <t t-if="question == line.question_id">
                                        <t t-if="question.question_type =='free_text'">
                                            <t t-if="question.as_table==False">
                                                <span t-field="line.value_free_text"/>
                                            </t>
                                            <t t-if="question.as_table==True">
                                                <t t-if="question.color_yellow==True">
                                                    <table border="1" width="100%" height="100%">
                                                        <tr border="1">
                                                            <td t-att-colspan="3" style="background-color:yellow;"
                                                                class="text-center"
                                                                width="20%" height="100px;">
                                                                <span t-field="question.title"></span>
                                                            </td>
                                                            <td t-att-colspan="3" height="100px;">
                                                                <span t-field="line.value_free_text"/>

                                                            </td>

                                                        </tr>
                                                    </table>
                                                </t>
                                                <t t-if="question.color_green==True">

                                                    <table border="1" width="100%" height="100%">
                                                        <tr border="1">
                                                            <td t-att-colspan="3" style="background-color:#90ee90;"
                                                                class="text-center"
                                                                width="20%" height="100px;">
                                                                <span t-field="question.title"></span>
                                                            </td>
                                                            <td t-att-colspan="3" height="100px;">
                                                                <span t-field="line.value_free_text"/>

                                                            </td>

                                                        </tr>
                                                    </table>
                                                </t>
                                                <t t-if="question.color_green==False and question.color_yellow==False">

                                                    <table border="1" width="100%" height="100%">
                                                        <tr border="1">
                                                            <td t-att-colspan="3" class="text-center"
                                                                width="20%" height="100px;">
                                                                <span t-field="question.title"></span>
                                                            </td>
                                                            <td t-att-colspan="3" height="100px;">
                                                                <span t-field="line.value_free_text"/>

                                                            </td>

                                                        </tr>
                                                    </table>
                                                </t>

                                            </t>

                                        </t>
                                        <br/>
                                        <t t-if="question.question_type =='matrix'">
                                            <table t-if="question.multi_row == False" class="table table-hover">
                                                <thead>
                                                    <tr>
                                                        <th></th>
                                                        <th t-foreach="question.labels_ids" t-as="col_label">
                                                            <span t-field="col_label.value"/>
                                                        </th>
                                                    </tr>
                                                </thead>
                                                <tbody>
                                                    <tr t-foreach="question.labels_ids_2" t-as="row_label">
                                                        <th>
                                                            <span t-field="row_label.value"/>
                                                        </th>
                                                        <td t-foreach="question.labels_ids" t-as="col_label">
                                                            <input t-if="question.matrix_subtype == 'simple'"
                                                                   type="radio"
                                                                   t-att-name="'%s_%s' % (prefix, row_label.id)"
                                                                   t-att-value='col_label.id'/>
                                                            <input t-if="question.matrix_subtype == 'multiple'"
                                                                   type="checkbox"
                                                                   t-att-name="'%s_%s_%s' % (prefix, row_label.id, col_label.id)"
                                                                   t-att-value='col_label.id'/>
                                                        </td>
                                                    </tr>
                                                </tbody>
                                            </table>
                                            <table t-if="question.multi_row == True"
                                                   style="border: 1px solid black;width:100%;height:100%;">
                                                <thead t-if="question.need_header == True">
                                                    <tr>
                                                        <th style="border: 2px solid black;"
                                                            t-foreach="question.header_labels" t-as="col_label"
                                                            class="text-center" align="center" t-att-colspan="2">
                                                            <span t-field="col_label.value"/>
                                                        </th>
                                                        <!--
                                                        -->
                                                        <th style="border: 2px solid black;"
                                                            t-foreach="question.header_labels" t-as="col_label"
                                                            class="text-center" align="center">
                                                            <span t-field="col_label.value2"/>
                                                        </th>
                                                        <th style="border: 2px solid black;"
                                                            t-foreach="question.header_labels" t-as="col_label"
                                                            class="text-center" align="center">
                                                            <span t-field="col_label.value3"/>
                                                        </th>
                                                        <th style="border: 1px solid grey;" class="text-center"
                                                            align="center">
                                                            <span/>
                                                        </th>
                                                        <th style="border: 2px solid black;background-color:#90ee90;"
                                                            t-foreach="question.labels_ids" t-as="col_label"
                                                            class="text-center" align="center">
                                                            <span t-field="col_label.value"/>
                                                        </th>

                                                    </tr>
                                                    <tr style="border: 1px solid black;width:4%;height:20px;"
                                                        t-if="question.need_header==True">
                                                        <th style="border: 1px solid grey;"></th>
                                                        <th style="border: 1px solid grey;"></th>
                                                        <th style="border: 1px solid grey;"></th>
                                                        <th style="border: 1px solid grey;"
                                                            t-foreach="question.labels_ids" t-as="col_label">
                                                            <span/>
                                                        </th>
                                                    </tr>
                                                </thead>
                                                <tbody>
                                                    <tr>

                                                        <t t-set="count" t-value="len(question.labels_ids_2)+2"/>
                                                        <th style="background-color:yellow;border: 1px solid black;width:200px;"
                                                            t-att-rowspan="count" class="text-center" align="center">
                                                            <span t-field="question.title"/>
                                                        </th>
                                                        <th style="border: 1px solid grey;width:15px;"
                                                            t-att-rowspan="count">
                                                        </th>

                                                        <tr t-foreach="question.labels_ids_2" t-as="row_label">


                                                            <th style="border: 1px solid black;width:300px;"
                                                                t-if="row_label.value2">
                                                                <span t-field="row_label.value2"/>
                                                            </th>
                                                            <th style="border: 1px solid black;width:300px;"
                                                                class="text-right" align="right"
                                                                t-if="row_label.value3">
                                                                <span t-field="row_label.value3"/>
                                                            </th>
                                                            <th style="border: 1px solid grey;width:15px;"
                                                                class="text-right">
                                                                <span/>
                                                            </th>

                                                            <td style="border: 1px solid black;"
                                                                t-foreach="question.labels_ids" t-as="col_label"
                                                                class="text-center" align="center">
                                                                <input style="border: 1px solid black;"
                                                                       t-if="question.matrix_subtype == 'simple'"
                                                                       type="radio"
                                                                       t-att-name="'%s_%s' % (prefix, row_label.id)"
                                                                       t-att-value='col_label.id'/>
                                                                <input style="border: 1px solid black;"
                                                                       t-if="question.matrix_subtype == 'multiple'"
                                                                       type="checkbox"
                                                                       t-att-name="'%s_%s_%s' % (prefix, row_label.id, col_label.id)"
                                                                       t-att-value='col_label.id'/>

                                                            </td>
                                                        </tr>
                                                        <tr>
                                                            <th style="background-color:#DFE9F2;border: 1px solid black;width:200px;"
                                                                t-att-colspan="2" class="text-left" align="left">
                                                                <span>Score:</span>
                                                            </th>
                                                            <th style="border: 1px solid grey;width:15px;"
                                                                class="text-left" align="left">
                                                                <span></span>
                                                            </th>
                                                            <td style="border: 1px solid black;background-color:#DFE9F2;"
                                                                t-foreach="question"
                                                                t-as="col_label"
                                                                class="text-center" align="center">
                                                                <span t-esc="sum(q.answer_score for q in question.labels_ids if q.question_id == col_label)"></span>

                                                            </td>
                                                        </tr>
                                                    </tr>


                                                </tbody>
                                            </table>


                                        </t>
                                        <br/>


                                    </t>


                                </tr>
                            </t>
                        </t>


                    </div>
                </t>
            </t>
        </t>
    </template>
</odoo>
